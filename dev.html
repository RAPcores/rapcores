
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Developer Docs &#8212; RAPcores  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Motor Control" href="motor_control.html" />
    <link rel="prev" title="Board Configuration" href="configuration.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="developer-docs">
<h1>Developer Docs<a class="headerlink" href="#developer-docs" title="Permalink to this headline">¶</a></h1>
<section id="build-prerequisites">
<h2>Build Prerequisites<a class="headerlink" href="#build-prerequisites" title="Permalink to this headline">¶</a></h2>
<p>RAPcores targets the FOSS synthesis, place and route, and bitstream tools. Namely yosys and

nextpnr. We are open to support other flows and open source tool chain. However do note

that RAPcores does use some SystemVerilog features supported by Yosys.</p>
<p>We recommend using a relatively recent build of these tools. The ones included in LTS Linux

distros may be out of date.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/YosysHQ/yosys">Yosys</a></p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/nextpnr">nextpnr</a></p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/icestorm">icestorm</a> (ice40 targets)</p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/prjtrellis">prjtrellis</a> (ECP5 targets)</p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/apicula">apicula</a> (Gowin targets)</p></li>
<li><p><a class="reference external" href="https://github.com/gatecat/prjoxide">prjoxide</a> (nexus targets)</p></li>
<li><p><a class="reference external" href="https://github.com/verilator/verilator">verilator</a> (Optional, for linting/testbenches)</p></li>
<li><p><a class="reference external" href="https://github.com/steveicarus/iverilog">iverilog</a> (Optional, for linting/testbenches)</p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/SymbiYosys">SymbiYosys</a> (Optional, for formal verification)</p></li>
</ul>
</section>
<section id="overview-of-make-targets">
<h2>Overview of Make targets<a class="headerlink" href="#overview-of-make-targets" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>Arguments</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>clean</p></td>
<td><p>BOARD</p></td>
<td><p>remove build artifacts</p></td>
</tr>
<tr class="row-odd"><td><p>prog</p></td>
<td><p>BOARD</p></td>
<td><p>build and program BOARD</p></td>
</tr>
<tr class="row-even"><td><p>formal</p></td>
<td><p>BOARD</p></td>
<td><p>run formal verification</p></td>
</tr>
<tr class="row-odd"><td><p>stat</p></td>
<td><p>BOARD</p></td>
<td><p>get yosys synthesis statistics</p></td>
</tr>
<tr class="row-even"><td><p>iverilog-parse</p></td>
<td><p></p></td>
<td><p>parse the src directory with iverilog</p></td>
</tr>
<tr class="row-odd"><td><p>yosys-parse</p></td>
<td><p></p></td>
<td><p>parse the src directory with yosys</p></td>
</tr>
<tr class="row-even"><td><p>verilator-cdc</p></td>
<td><p></p></td>
<td><p>parse the src directory and run CDC checks with verilator</p></td>
</tr>
<tr class="row-odd"><td><p>triple-check</p></td>
<td><p></p></td>
<td><p>parse the src directory with yosys, iverilog, and verilator</p></td>
</tr>
<tr class="row-even"><td><p>yosys-{test}</p></td>
<td><p></p></td>
<td><p>run the testbench recipe in <code class="docutils literal notranslate"><span class="pre">testbench/yosys/{test}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>cxxrtl-{test}</p></td>
<td><p></p></td>
<td><p>run the testbench recipe in <code class="docutils literal notranslate"><span class="pre">testbench/cxxrtl/{test}</span></code></p></td>
</tr>
<tr class="row-even"><td><p>docs-{fmt}</p></td>
<td><p></p></td>
<td><p>build docs in the specified format (e.g. docs-html)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="board-targets">
<h2>Board targets<a class="headerlink" href="#board-targets" title="Permalink to this headline">¶</a></h2>
<p>The following targets require a <code class="docutils literal notranslate"><span class="pre">BOARD</span></code> to be specified.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">BOARD</span><span class="o">=&lt;</span><span class="n">board</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Generate bit stream.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">clean</span> <span class="n">BOARD</span><span class="o">=&lt;</span><span class="n">board</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Clean build artifacts.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">prog</span> <span class="n">BOARD</span><span class="o">=&lt;</span><span class="n">board</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Generate bitstream and upload.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">stat</span> <span class="n">BOARD</span><span class="o">=&lt;</span><span class="n">board</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Get logic synthesis statistics for the given configuration.</p>
</section>
<section id="formal-verification">
<h2>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h2>
<p>SymbiYosys is used for formal verification of the code base. It can be run with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">formal</span> <span class="n">BOARD</span><span class="o">=&lt;</span><span class="n">board</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This command will create a <code class="docutils literal notranslate"><span class="pre">symbiyosys_&lt;board&gt;</span></code> directory in the <code class="docutils literal notranslate"><span class="pre">symbiyosys</span></code> directory

contains all the logs and data from the verification. If an assert or

cover fails, a <code class="docutils literal notranslate"><span class="pre">.vcd</span></code> file will be generated that will display the states

of registers and wires that induced the failure. GTKWave is a useful

program for viewing the <code class="docutils literal notranslate"><span class="pre">.vcd</span></code> files.</p>
<p>The base config for Symbiyosys is <code class="docutils literal notranslate"><span class="pre">symbiyosys.sby</span></code> in the <code class="docutils literal notranslate"><span class="pre">symbiyosys</span></code> directory.

Board specific defines are overlaid on top to ensure that each board configuration

can be validated.</p>
</section>
<section id="test-benches">
<h2>Test Benches<a class="headerlink" href="#test-benches" title="Permalink to this headline">¶</a></h2>
<p>The main RAPcores source is tested for compatibility against Yosys, IVerilog, and Verilator.

In-tree testbenches use the Yosys suite with either the default &lsquo;sim&rsquo; or &lsquo;cxxrtl&rsquo; backends.</p>
<section id="yosys-sim-bench">
<h3>Yosys Sim Bench<a class="headerlink" href="#yosys-sim-bench" title="Permalink to this headline">¶</a></h3>
<p>The yosys test benches can be executed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">yosys</span><span class="o">-&lt;</span><span class="n">sim</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">yosys-spi</span></code> will run the <code class="docutils literal notranslate"><span class="pre">spi.ys</span></code> simulation located in <code class="docutils literal notranslate"><span class="pre">testbench/yosys/&lt;sim</span> <span class="pre">name&gt;</span></code>.</p>
</section>
<section id="yosys-cxxrtl-bench-experimental">
<h3>Yosys CXXRTL Bench (experimental)<a class="headerlink" href="#yosys-cxxrtl-bench-experimental" title="Permalink to this headline">¶</a></h3>
<p>CXXRTL text benches are Verilog to C++ transpiled testbenches. To run these a compiler and C++ driver

program is required. 

The yosys CXXRTL test benches can be executed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">cxxrtl</span><span class="o">-&lt;</span><span class="n">sim</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">cxxrtl-rapcore</span></code> will run the <code class="docutils literal notranslate"><span class="pre">rapcore.ys</span></code> simulation located in <code class="docutils literal notranslate"><span class="pre">testbench/cxxrtl/&lt;sim</span> <span class="pre">name&gt;</span></code>.</p>
</section>
</section>
<section id="formatting">
<h2>Formatting<a class="headerlink" href="#formatting" title="Permalink to this headline">¶</a></h2>
<p>All files should have <code class="docutils literal notranslate"><span class="pre">none</span></code> as the default nettype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`default_nettype none
</pre></div>
</div>
</section>
<section id="linting">
<h2>Linting<a class="headerlink" href="#linting" title="Permalink to this headline">¶</a></h2>
<p>For parser compatibility and linting one can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">triple</span><span class="o">-</span><span class="n">check</span>
</pre></div>
</div>
<p>which will parse the source using Yosys, IVerilog, and Verilator.</p>
</section>
<section id="developing-with-nix">
<h2>Developing with Nix<a class="headerlink" href="#developing-with-nix" title="Permalink to this headline">¶</a></h2>
<p>RAPcores includes a <a class="reference external" href="../shell.nix">shell.nix</a> for use with the Nix Package manager.

This makes it easy to get a development environment with all build requirements installed

for you.</p>
<p>To start you will need to install Nix using the instructions <a class="reference external" href="https://nixos.wiki/wiki/Nix_Installation_Guide">here</a>.

They are reproduced here with some recommendations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo install -d -m755 -o $(id -u) -g $(id -g) /nix
curl -L https://nixos.org/nix/install | sh
source $HOME/.nix-profile/etc/profile.d/nix.sh &gt;&gt; ~/.bashrc
</pre></div>
</div>
<p>Then restart the terminal. Next, <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the RAPcores directory. Run <code class="docutils literal notranslate"><span class="pre">nix-shell</span></code>, and some

packages will be installed. Once complete you should be able to run any of the <code class="docutils literal notranslate"><span class="pre">make</span></code> commands

below. This environment includes all the tools to synthesis, place, route, program, and

formally verify the RAPcores project.</p>
<section id="packages-included-in-nix-environment">
<h3>Packages included in Nix environment<a class="headerlink" href="#packages-included-in-nix-environment" title="Permalink to this headline">¶</a></h3>
<p>Verilog frontends:</p>
<ul class="simple">
<li><p>yosys</p></li>
<li><p>verilog </p></li>
<li><p>verilator</p></li>
</ul>
<p>Place and route/databases:</p>
<ul class="simple">
<li><p>nextpnr</p></li>
<li><p>icestorm</p></li>
<li><p>trellis</p></li>
</ul>
<p>Formal verification:</p>
<ul class="simple">
<li><p>symbiyosys</p></li>
<li><p>yices</p></li>
</ul>
<p>Programmers:</p>
<ul class="simple">
<li><p>tinyprog</p></li>
<li><p>fujprog</p></li>
<li><p>openocd</p></li>
</ul>
</section>
</section>
<section id="helpful-articles">
<h2>Helpful Articles<a class="headerlink" href="#helpful-articles" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>https://zipcpu.com/blog/2020/01/13/reuse.html</p></li>
<li><p>https://www.reddit.com/r/yosys/comments/6ulm3m/new_simulation_within_yosys/</p></li>
</ul>
</section>
<section id="useful-tools">
<h2>Useful Tools<a class="headerlink" href="#useful-tools" title="Permalink to this headline">¶</a></h2>
<p>Google&rsquo;s Verilog formatter and linter:

- https://github.com/google/verible/</p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RAPcores</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi_spec.html">SPI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Board Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-prerequisites">Build Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-make-targets">Overview of Make targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#board-targets">Board targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formal-verification">Formal Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-benches">Test Benches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formatting">Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linting">Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developing-with-nix">Developing with Nix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpful-articles">Helpful Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useful-tools">Useful Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="motor_control.html">Motor Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="librapcore.html">librapcore</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Software Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="asic.html">RAPcores on ASIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Board Configuration</a></li>
      <li>Next: <a href="motor_control.html" title="next chapter">Motor Control</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-1980, RAPcore developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/dev.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>