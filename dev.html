
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Developer Docs &#8212; RAPcores  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Motor Control" href="motor_control.html" />
    <link rel="prev" title="Board Configuration" href="configuration.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="developer-docs">
<h1>Developer Docs<a class="headerlink" href="#developer-docs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="build-prerequisites">
<h2>Build Prerequisites<a class="headerlink" href="#build-prerequisites" title="Permalink to this headline">¶</a></h2>
<p>RAPcores targets the FOSS synthesis, place and route, and bitstream tools. Namely yosys and
nextpnr. We are open to support other flows and open source tool chain. However do note
that RAPcores does use some SystemVerilog features supported by Yosys.</p>
<p>We recommend using a relatively recent build of these tools. The ones included in Linux
distros may be out of date. Using the Nix package manager with the included <code class="docutils literal notranslate"><span class="pre">shell.nix</span></code> is
recommended.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/YosysHQ/yosys">Yosys</a></p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/nextpnr">nextpnr</a></p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/icestorm">icestorm</a> (ice40 targets)</p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/prjtrellis">prjtrellis</a> (ECP5 targets)</p></li>
<li><p><a class="reference external" href="https://github.com/verilator/verilator">verilator</a> (Optional, for linting/testbenches)</p></li>
<li><p><a class="reference external" href="https://github.com/steveicarus/iverilog">iverilog</a> (Optional, for linting/testbenches)</p></li>
<li><p><a class="reference external" href="https://github.com/YosysHQ/SymbiYosys">SymbiYosys</a> (Optional, for formal verification)</p></li>
</ul>
</div>
<div class="section" id="developing-with-nix">
<h2>Developing with Nix<a class="headerlink" href="#developing-with-nix" title="Permalink to this headline">¶</a></h2>
<p>RAPcores includes a <a class="reference external" href="../shell.nix">shell.nix</a> for use with the Nix Package manager.
This makes it easy to get a development environment with all build requirements installed
for you.</p>
<p>To start you will need to install Nix using the instructions <a class="reference external" href="https://nixos.wiki/wiki/Nix_Installation_Guide">here</a>.
They are reproduced here with some recommendations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo install -d -m755 -o $(id -u) -g $(id -g) /nix
curl -L https://nixos.org/nix/install | sh
source $HOME/.nix-profile/etc/profile.d/nix.sh &gt;&gt; ~/.bashrc
</pre></div>
</div>
<p>Then restart the terminal. Next, <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the RAPcores directory. Run <code class="docutils literal notranslate"><span class="pre">nix-shell</span></code>, and some
packages will be installed. Once complete you should be able to run any of the <code class="docutils literal notranslate"><span class="pre">make</span></code> commands
below. This environment includes all the tools to synthesis, place, route, program, and
formally verify the RAPcores project.</p>
<div class="section" id="packages-included-in-nix-environment">
<h3>Packages included in Nix environment<a class="headerlink" href="#packages-included-in-nix-environment" title="Permalink to this headline">¶</a></h3>
<p>Verilog frontends:</p>
<ul class="simple">
<li><p>yosys</p></li>
<li><p>verilog</p></li>
<li><p>verilator</p></li>
</ul>
<p>Place and route/databases:</p>
<ul class="simple">
<li><p>nextpnr</p></li>
<li><p>icestorm</p></li>
<li><p>trellis</p></li>
</ul>
<p>Formal verification:</p>
<ul class="simple">
<li><p>symbiyosys</p></li>
<li><p>yices</p></li>
</ul>
<p>Programmers:</p>
<ul class="simple">
<li><p>tinyprog</p></li>
<li><p>fujprog</p></li>
<li><p>openocd</p></li>
</ul>
</div>
</div>
<div class="section" id="overview-of-make-targets">
<h2>Overview of Make targets<a class="headerlink" href="#overview-of-make-targets" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<thead>
<tr>
<th>Target</th>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>clean</td>
<td>BOARD</td>
<td>remove build artifacts</td>
</tr>
<tr>
<td>prog</td>
<td>BOARD</td>
<td>build and program BOARD</td>
</tr>
<tr>
<td>formal</td>
<td>BOARD</td>
<td>run formal verification</td>
</tr>
<tr>
<td>stat</td>
<td>BOARD</td>
<td>get yosys synthesis statistics</td>
</tr>
<tr>
<td>iverilog-parse</td>
<td></td>
<td>parse the src directory with iverilog</td>
</tr>
<tr>
<td>yosys-parse</td>
<td></td>
<td>parse the src directory with yosys</td>
</tr>
<tr>
<td>verilator-cdc</td>
<td></td>
<td>parse the src directory and run CDC checks with verilator</td>
</tr>
<tr>
<td>triple-check</td>
<td></td>
<td>parse the src directory with yosys, iverilog, and verilator</td>
</tr>
<tr>
<td>yosys-{test}</td>
<td></td>
<td>run the testbench recipe in <code>testbench/yosys/{test}</code></td>
</tr>
<tr>
<td>cxxrtl-{test}</td>
<td></td>
<td>run the testbench recipe in <code>testbench/cxxrtl/{test}</code></td>
</tr>
</tbody>
</table></div>
<div class="section" id="board-targets">
<h2>Board targets<a class="headerlink" href="#board-targets" title="Permalink to this headline">¶</a></h2>
<p>The following targets require a <code class="docutils literal notranslate"><span class="pre">BOARD</span></code> to be specified.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">BOARD=&lt;board&gt;</span></code></p>
<p>Generate bit stream.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span> <span class="pre">BOARD=&lt;board&gt;</span></code></p>
<p>Clean build artifacts.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">prog</span> <span class="pre">BOARD=&lt;board&gt;</span></code></p>
<p>Generate bitstream and upload.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">stat</span> <span class="pre">BOARD=&lt;board&gt;</span></code></p>
<p>Get logic synthesis statistics for the given configuration.</p>
</div>
<div class="section" id="formal-verification">
<h2>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h2>
<p>SymbiYosys is used for formal verification of the code base. It can be run with:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">formal</span></code></p>
<p>This command will create a <code class="docutils literal notranslate"><span class="pre">symbiyosys</span></code> directory in the project that
contains all the logs and data from the verification. If an assert or
cover fails, a <code class="docutils literal notranslate"><span class="pre">.vcd</span></code> file will be generated that will display the states
of registers and wires that induced the failure. GTKWave is a useful
program for viewing the <code class="docutils literal notranslate"><span class="pre">.vcd</span></code> files.</p>
<p>The config for Symbiyosys is <code class="docutils literal notranslate"><span class="pre">symbiyosys.sby</span></code> in the root of the directory.
The formal verification configuration file is <code class="docutils literal notranslate"><span class="pre">boards/formal_config.v</span></code>.</p>
</div>
<div class="section" id="test-benches">
<h2>Test Benches<a class="headerlink" href="#test-benches" title="Permalink to this headline">¶</a></h2>
<p>The main RAPcores source is tested for compatibility against Yosys, IVerilog, and Verilator.
In-tree testbenches use the Yosys suite with either the default ‘sim’ or ‘cxxrtl’ backends.</p>
<div class="section" id="yosys-sim-bench">
<h3>Yosys Sim Bench<a class="headerlink" href="#yosys-sim-bench" title="Permalink to this headline">¶</a></h3>
<p>The yosys test benches can be executed with:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">yosys-&lt;sim</span> <span class="pre">name&gt;</span></code></p>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">yosys-spi</span></code> will run the <code class="docutils literal notranslate"><span class="pre">spi.ys</span></code> simulation located in <code class="docutils literal notranslate"><span class="pre">testbench/yosys/&lt;sim</span> <span class="pre">name&gt;</span></code>.</p>
</div>
<div class="section" id="yosys-cxxrtl-bench-experimental">
<h3>Yosys CXXRTL Bench (experimental)<a class="headerlink" href="#yosys-cxxrtl-bench-experimental" title="Permalink to this headline">¶</a></h3>
<p>CXXRTL text benches are Verilog to C++ transpiled testbenches. To run these a compiler and C++ driver
program is required.
The yosys CXXRTL test benches can be executed with:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">cxxrtl-&lt;sim</span> <span class="pre">name&gt;</span></code></p>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">cxxrtl-rapcore</span></code> will run the <code class="docutils literal notranslate"><span class="pre">rapcore.ys</span></code> simulation located in <code class="docutils literal notranslate"><span class="pre">testbench/cxxrtl/&lt;sim</span> <span class="pre">name&gt;</span></code>.</p>
</div>
</div>
<div class="section" id="formatting">
<h2>Formatting<a class="headerlink" href="#formatting" title="Permalink to this headline">¶</a></h2>
<p>All files should have <code class="docutils literal notranslate"><span class="pre">none</span></code> as the default nettype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`default_nettype none
</pre></div>
</div>
</div>
<div class="section" id="linting">
<h2>Linting<a class="headerlink" href="#linting" title="Permalink to this headline">¶</a></h2>
<p>For parser compatibility and linting one can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">triple</span><span class="o">-</span><span class="n">check</span>
</pre></div>
</div>
<p>which will parse the source using Yosys, IVerilog, and Verilator.</p>
</div>
<div class="section" id="helpful-articles">
<h2>Helpful Articles<a class="headerlink" href="#helpful-articles" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>https://zipcpu.com/blog/2020/01/13/reuse.html</p></li>
<li><p>https://www.reddit.com/r/yosys/comments/6ulm3m/new_simulation_within_yosys/</p></li>
</ul>
</div>
<div class="section" id="useful-tools">
<h2>Useful Tools<a class="headerlink" href="#useful-tools" title="Permalink to this headline">¶</a></h2>
<p>Google’s Verilog formatter and linter:</p>
<ul class="simple">
<li><p>https://github.com/google/verible/</p></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RAPcores</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi_spec.html">SPI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Board Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-prerequisites">Build Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developing-with-nix">Developing with Nix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-make-targets">Overview of Make targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#board-targets">Board targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formal-verification">Formal Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-benches">Test Benches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formatting">Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linting">Linting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpful-articles">Helpful Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useful-tools">Useful Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="motor_control.html">Motor Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="asic.html">RAPcores on ASIC</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Board Configuration</a></li>
      <li>Next: <a href="motor_control.html" title="next chapter">Motor Control</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2021, RAPcore developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/dev.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>