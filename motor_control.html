
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Motor Control &#8212; RAPcores  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="librapcore" href="librapcore.html" />
    <link rel="prev" title="Developer Docs" href="dev.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="motor-control">
<h1>Motor Control<a class="headerlink" href="#motor-control" title="Permalink to this headline">¶</a></h1>
<p>This section describes the principles of motor control at a low level.</p>
<div class="section" id="electrical-commutation">
<h2>Electrical Commutation<a class="headerlink" href="#electrical-commutation" title="Permalink to this headline">¶</a></h2>
<p>Electrical commutation is the process of generating rotating magnetic fields in
an electromagnetic system. In electric motors this involves the generation of AC and DC
signals. Some simple motors may do this mechanically, however for precision applications
such as robotics and manufacturing it is done with digital control systems.</p>
<p>Many types of motors may be controlled with electrical commutation:</p>
<ul class="simple">
<li><p>Brushless DC</p></li>
<li><p>Induction</p></li>
<li><p>Stepper</p></li>
<li><p>Switched Reluctance</p></li>
</ul>
<p>There are of course many innovative topologies being developed every year, and
many of these use the same operating principles as the above. RAPcores aims
to provide a toolkit for controlling a wide range of motor types.</p>
<p>The two basic elements of a motor controller are:</p>
<ul class="simple">
<li><p>Power systems</p></li>
<li><p>Control systems</p></li>
</ul>
<p>The power systems element is the element that handle the (relatively) high
power that drives the motor. Typically MOSFETs or IGBTs are used in full or H bridge
inverter configurations to generate AC voltages. It may include additional sensors such as an
encoder, voltage sensor, and current sensor. All three are preferred for
closed-loop control.</p>
<p>The control systems element is the software or digital logic system managing
inputs and outputs of the power circuitry, sensors, and input trajectories.
In RAPcores the low levels of this are handled in FPGA or ASIC, with a
microcontroller or CPU handling high level trajectory planning. The job of the
control system is to ensure the motor is following the defined trajectory or
set behavior.</p>
</div>
<div class="section" id="bridge-control">
<h2>Bridge Control<a class="headerlink" href="#bridge-control" title="Permalink to this headline">¶</a></h2>
<p>Below is a simple motor control hierarchy:</p>
<img alt="_images/controller-hierarchy.svg" src="_images/controller-hierarchy.svg" /><p>Bridge control involves the timing of output signals such that
the motor power circuitry creates the desires voltage and current
in each coil of the motor. In addition, it needs to be fault aware
and control timing to create smooth operation. Typically high-resolution
PWM signals are used at supra-audible frequencies (&gt;35kHz).</p>
<p>Due to the use of PWM and commutation, the voltages are non-contant. There
are some timing considerations when switching the motor:</p>
<ul class="simple">
<li><p>Dead time</p></li>
<li><p>Off time</p></li>
<li><p>On time</p></li>
<li><p>Blank time</p></li>
</ul>
<p>Dead time is the time required for a transistor in the bridge to turn on or off.
When switching polarities, it is important the controller wait this “dead time”,
or delay, before changing the direction of the inverter otherwise breakage might occur.</p>
<p>Off time and On time are the duration the PWM signal is on or off. The relation of
these two is relevant to current and voltage measurements of the motor. Measuring
voltage and current over time allows for measurement of resistance and inductance
in the motor.</p>
<p>Blank time is related to the propogation delay of measuring the outputs to the motor.
Since a digital design can react on a cycle-to-cycle basis of the PWM, delays
must be accounted in elements such as ADCs and comparators before measuring
then reacting to a change in the power output.</p>
</div>
<div class="section" id="motor-fault-types">
<h2>Motor Fault Types<a class="headerlink" href="#motor-fault-types" title="Permalink to this headline">¶</a></h2>
<p>The following faults may occur in a motor:</p>
<ul class="simple">
<li><p>Disconnection</p></li>
<li><p>Overcurrent</p></li>
<li><p>Undervoltage</p></li>
<li><p>Thermal Shutdown</p></li>
<li><p>Overvoltage</p></li>
</ul>
<p>A good bridge design should be able to handle the majority of these
fault conditions and report back to higher level controllers for
rectification by the user or path planner. In RAPcores there are
fault diagnostic registers for each motor channel.</p>
</div>
<div class="section" id="space-vector-modulation">
<h2>Space Vector Modulation<a class="headerlink" href="#space-vector-modulation" title="Permalink to this headline">¶</a></h2>
<p>The key to smooth and efficient motor control is a high precision electrical commutator.
To achieve this, precise currents and voltages must be generated. Moreover, they
must rotate the magnetic field at a wide variety of speeds and accelerations.
As mentioned, PWM signals are used to control the power output and to rotate the
magnetic field with PWM, we use a Space Vector Modulator.</p>
<p>Two elements are required for Space Vector Modulation or SVM:</p>
<ul class="simple">
<li><p>Microstepping (subdividing the commutation table)</p></li>
<li><p>Current regulation (limiting power output for efficiency)</p></li>
</ul>
<p>To understand the concepts and mathematics of the rotating magnetic field,
we will use vectors and phasors.</p>
<div class="section" id="vector-concepts">
<h3>Vector Concepts<a class="headerlink" href="#vector-concepts" title="Permalink to this headline">¶</a></h3>
<p>Here we will present the mathematical ideas of how to model a rotating magnetic field in a bipolar stepper
motor as a vector. This is known as <a class="reference external" href="https://en.wikipedia.org/wiki/Space_vector_modulation">Space Vector Modulation</a>.
To start we must understand some basic concepts from vector algebra and trigonometry.</p>
<p>Recall that sine and cosine are derived from the components of a vector rotating around the origin:</p>
<img alt="https://upload.wikimedia.org/wikipedia/commons/b/bd/Sine_and_cosine_animation.gif" src="https://upload.wikimedia.org/wikipedia/commons/b/bd/Sine_and_cosine_animation.gif" />
<p>And recall the identity where:</p>
<div class="math notranslate nohighlight">
\[cos(\theta)^2+sin(\theta)^2=1\]</div>
<p>Or alternatively:</p>
<div class="math notranslate nohighlight">
\[A \cdot cos(\theta)^2+A \cdot sin(\theta)^2=A\]</div>
<p>The above equation is essential in our understanding of constructing the vector. Recall the phase table for the bipolar stepper:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>+</p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p>+</p></td>
</tr>
</tbody>
</table>
<p>If we visualize each phase as a 2D plot we can see these commutation steps form the corners of a square as shown below:</p>
<img alt="_images/bipolar-svm.svg" src="_images/bipolar-svm.svg" /><p>Microstepping is possible in this space (a square), however it yields undesirable effects since the total current in the motor
varies due to a change of vector length as shown in the red arrow above. This can yield resonance and torque ripples. The objective
is to create smooth motion as we traverse between the phases. Therefore we need to move our vector along a circle, such as the arrows in blue above. The trade-off is
that we do not achieve the peak torque attainable in the corners of the square, but instead the motion is smooth and controllable.</p>
</div>
<div class="section" id="pwm-concepts">
<h3>PWM Concepts<a class="headerlink" href="#pwm-concepts" title="Permalink to this headline">¶</a></h3>
<p>Below is a simple PWM module in verilog:</p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span>  <span class="cm">/*</span>
<span class="lineno"> 2 </span><span class="cm">  Simple PWM module</span>
<span class="lineno"> 3 </span><span class="cm">  */</span>
<span class="lineno"> 4 </span>  <span class="k">module</span> <span class="n">pwm</span> <span class="p">#(</span>
<span class="lineno"> 5 </span>      <span class="k">parameter</span> <span class="n">bits</span> <span class="o">=</span> <span class="mh">8</span>
<span class="lineno"> 6 </span>  <span class="p">)</span> <span class="p">(</span>
<span class="lineno"> 7 </span>      <span class="k">input</span>  <span class="n">clk</span><span class="p">,</span>
<span class="lineno"> 8 </span>      <span class="k">input</span>  <span class="n">resetn</span><span class="p">,</span>
<span class="lineno"> 9 </span>      <span class="k">input</span>  <span class="p">[</span><span class="n">bits</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">val</span><span class="p">,</span>
<span class="lineno">10 </span>      <span class="k">output</span> <span class="n">pwm</span>
<span class="lineno">11 </span>  <span class="p">);</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>    <span class="kt">reg</span> <span class="p">[</span><span class="n">bits</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">accum</span><span class="p">;</span>
<span class="lineno">14 </span>    <span class="k">assign</span> <span class="n">pwm</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">);</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span>
<span class="lineno">17 </span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">resetn</span><span class="p">)</span>
<span class="lineno">18 </span>      <span class="n">accum</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
<span class="lineno">19 </span>    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resetn</span><span class="p">)</span>
<span class="lineno">20 </span>      <span class="n">accum</span> <span class="o">&lt;=</span> <span class="n">accum</span> <span class="o">+</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>  <span class="k">endmodule</span>
</pre></div>
</div>
<p>We can see that the PWM output frequency is a function of the base clock frequency (<cite>clk</cite>) and the number of bits used for the accumulator. E.g.:</p>
<div class="math notranslate nohighlight">
\[F_{PMW} = \frac{F_{clk}}{2^{bits}}\]</div>
<p>For quiet operation and fast updates we want the PWM frequency to be superaudible, so a value greater than 30khz. Assume we use a PLL to achieve
a higher operational frequency for <cite>PWM</cite> module at 150mhz. The bit resolution of the PWM can be calculated thus:</p>
<div class="math notranslate nohighlight">
\[bits = \log_2({F_{PMW}/F_{clk}})\]</div>
<p>In our example of a 30khz output with a 150mhz accumulator clock we get ~12.3 bit resolution. For simplicity we will use 12 bits going forward.</p>
<p>Now the challenge is how to compute the value to the PWM such that we bring both the current and the microstep/phase angle into a single value.
In the next section we will see this is a relatively straight forward process that falls out of the vector model.</p>
</div>
<div class="section" id="applied-space-vector-modulation">
<h3>Applied Space Vector Modulation<a class="headerlink" href="#applied-space-vector-modulation" title="Permalink to this headline">¶</a></h3>
<p>Recall that a vector (<span class="math notranslate nohighlight">\(\vec{A}\)</span>) may be element-wise scaled by a given factor such that the length (<span class="math notranslate nohighlight">\(\left\lVert\vec{A}\right\rVert\)</span>) is scaled by the same factor.
Our vector is formed from a given angle (or microstep position) <span class="math notranslate nohighlight">\(\theta\)</span> as: <span class="math notranslate nohighlight">\((cos(\theta), sin(\theta))\)</span>. Then scaling the current is simply multiplication of this vector
by a factor <cite>C</cite>: <span class="math notranslate nohighlight">\((C \cdot cos(\theta), C \cdot sin(\theta))\)</span>. Then using the above identify we known that the length of this vector is:</p>
<div class="math notranslate nohighlight">
\[\left\lVert(C \cdot cos(\theta), C \cdot sin(\theta))\right\rVert = C\]</div>
<p>Then the matter of partitioning the 12 bit space of the PWM become quite simple. For example we may use 8 bits for the trigonometric functions (implemented as lookup tables in practice), and 4 bits for current.
Which gives sufficient precision for 64 microsteps and 16 discrete current values.</p>
<p>So now we can do space vector modulation. But where do we put it? The answer is as a voltage reference or gate PWM input. For example we may use this output to
create a reference for a 1-bit ADC by adding a RC filter to the output in a <a class="reference external" href="https://en.wikipedia.org/wiki/Chopper_(electronics)">chopper drive</a>.
Or for a dead-reckoned approach this PWM can be used to quickly turn the gate drivers on and off. An example of this can be found in the RAPcores Dual H Bridge module.</p>
</div>
<div class="section" id="svm-in-three-phase">
<h3>SVM in Three Phase<a class="headerlink" href="#svm-in-three-phase" title="Permalink to this headline">¶</a></h3>
<p>For the mathematically inclined, you may notice that the bipolar stepper is nice
as the phases form an orthonormal basis in 2D space. In three phase or more motors, this is not the case,
as the vector is embedded in three or more dimensional space.</p>
<p>The technique used in three phase control is to project the three dimensional vector down into a two dimensional
space such that we can use simpler math for the control. In addition, the inverse may be applied, bringing us
from the two dimensional frame of reference to the three dimensional frame of reference for the three phase motor.</p>
<p>The forward transform:</p>
<div class="math notranslate nohighlight">
\[\begin{split}i_{\alpha\beta}(t) = \frac23 \begin{bmatrix} 1 &amp; -\frac12 &amp; -\frac12\\
0 &amp; \frac{\sqrt{3}}{2} &amp; -\frac{\sqrt{3}}{2}
\end{bmatrix}\begin{bmatrix}i_a(t)\\i_b(t)\\i_c(t)\end{bmatrix}\end{split}\]</div>
<p>The inverse transform:</p>
<div class="math notranslate nohighlight">
\[\begin{split}i_{abc}(t) = \frac32\begin{bmatrix} \frac23 &amp; 0 \\
-\frac{1}{3} &amp; \frac{\sqrt{3}}{3} \\
-\frac{1}{3} &amp; -\frac{\sqrt{3}}{3} \end{bmatrix}
\begin{bmatrix}i_\alpha(t)\\i_\beta(t)\end{bmatrix}\end{split}\]</div>
</div>
</div>
<div class="section" id="frequency-considerations">
<h2>Frequency Considerations<a class="headerlink" href="#frequency-considerations" title="Permalink to this headline">¶</a></h2>
<p>Below is a table showing some relevant stepping frequencies for a stock Prusa MK3S:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 53%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 13%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Prusa MK3S</p></th>
<th class="head"><p>X</p></th>
<th class="head"><p>Y</p></th>
<th class="head"><p>Z</p></th>
<th class="head"><p>E</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Full Steps/rev</p></td>
<td><p>200</p></td>
<td><p>200</p></td>
<td><p>200</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>Microsteps</p></td>
<td><p>16</p></td>
<td><p>16</p></td>
<td><p>16</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>Homing Feedrate (mm/sec)</p></td>
<td><p>50</p></td>
<td><p>50</p></td>
<td><p>13.3</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Max travel Rate (mm/sec)</p></td>
<td><p>200</p></td>
<td><p>200</p></td>
<td><p>12</p></td>
<td><p>120</p></td>
</tr>
<tr class="row-even"><td><p>(Steps*microsteps)/mm</p></td>
<td><p>100</p></td>
<td><p>100</p></td>
<td><p>400</p></td>
<td><p>280</p></td>
</tr>
<tr class="row-odd"><td><p>Microsteps/sec (travel)</p></td>
<td><p>20000</p></td>
<td><p>20000</p></td>
<td><p>4800</p></td>
<td><p>33600</p></td>
</tr>
<tr class="row-even"><td><p>Full Steps/sec (travel)</p></td>
<td><p>1250</p></td>
<td><p>1250</p></td>
<td><p>300</p></td>
<td><p>1050</p></td>
</tr>
<tr class="row-odd"><td><p>Microsteps/sec (homing)</p></td>
<td><p>5000</p></td>
<td><p>5000</p></td>
<td><p>5333.3</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Full Steps/sec (homing)</p></td>
<td><p>312.5</p></td>
<td><p>312.5</p></td>
<td><p>333.3</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="commutation-tables">
<h2>Commutation Tables<a class="headerlink" href="#commutation-tables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bipolar-stepper">
<h3>Bipolar Stepper<a class="headerlink" href="#bipolar-stepper" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>+</p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p>+</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="three-phase-bldc-induction">
<h3>Three Phase (BLDC, Induction)<a class="headerlink" href="#three-phase-bldc-induction" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
<th class="head"><p>C</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p>-</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>+</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>+</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>-</p></td>
<td><p>+</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="five-phase-stepper">
<h3>Five Phase Stepper<a class="headerlink" href="#five-phase-stepper" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
<th class="head"><p>C</p></th>
<th class="head"><p>D</p></th>
<th class="head"><p>E</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>+</p></td>
<td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
<td><p>+</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
<td><p>+</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p></p></td>
<td><p>-</p></td>
<td><p></p></td>
<td><p>+</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="analytical-models">
<h2>Analytical Models<a class="headerlink" href="#analytical-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="stepper-motor">
<h3>Stepper Motor<a class="headerlink" href="#stepper-motor" title="Permalink to this headline">¶</a></h3>
<p>A model of a hybrid stepper motor is given by Bodson, et. al.: [1]</p>
<div class="math notranslate nohighlight">
\[\frac{d \theta}{dt} = \omega\]</div>
<div class="math notranslate nohighlight">
\[\frac{d \omega}{dt} = ( -K_m i_a sin(N_r \theta) + K_m i_b cos(N_r \theta) - B \omega - \tau)/J\]</div>
<div class="math notranslate nohighlight">
\[\frac{d i_a}{dt} = ( v_a - R i_a + K_m sin(N_r \theta))/L\]</div>
<div class="math notranslate nohighlight">
\[\frac{i_b}{dt} = ( v_b - R i_b - K_m cos(N_r \theta))/L\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\omega\)</span> - Angular Velocity</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta\)</span> - Angular Position</p></li>
<li><p><span class="math notranslate nohighlight">\(J\)</span> - Rotor and Load Inertia</p></li>
<li><p><span class="math notranslate nohighlight">\(K_m\)</span> - Motor Torque constant</p></li>
<li><p><span class="math notranslate nohighlight">\(L\)</span> - Coil Inductance</p></li>
<li><p><span class="math notranslate nohighlight">\(R\)</span> - Coil Resistance</p></li>
<li><p><span class="math notranslate nohighlight">\(N_r\)</span> - Number of rotor teeth</p></li>
<li><p><span class="math notranslate nohighlight">\(i_a, i_b\)</span> - Coil Current</p></li>
<li><p><span class="math notranslate nohighlight">\(v_a, v_b\)</span> - Coil Current</p></li>
</ul>
<p>From this a simpler model for the current can be developed:</p>
<div class="math notranslate nohighlight">
\[i_{qr} = \frac{J}{K_m} \alpha_r + \frac{B}{K_m} \omega_r\]</div>
</div>
<div class="section" id="motoring-quadrants">
<h3>Motoring Quadrants<a class="headerlink" href="#motoring-quadrants" title="Permalink to this headline">¶</a></h3>
<p>Motoring quadrants are the four possible states a rotor and stator may take. Assuming
the stator is the driving portion and the rotor is connected to the load, either maybe
generating torque in conjunction or opposition to the desired motoring trajectory.
These states are illustrated below:</p>
<img alt="_images/motoring-quadrants.svg" src="_images/motoring-quadrants.svg" /></div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1]M. Bodson and J. N. Chiasson, “High-Performance Nonlinear Feedback Control of a Permanent Magnet Stepper Motor,” p. 10.</p>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RAPcores</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi_spec.html">SPI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Board Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Developer Docs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Motor Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#electrical-commutation">Electrical Commutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bridge-control">Bridge Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#motor-fault-types">Motor Fault Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#space-vector-modulation">Space Vector Modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#frequency-considerations">Frequency Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commutation-tables">Commutation Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analytical-models">Analytical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="librapcore.html">librapcore</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Software Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="asic.html">RAPcores on ASIC</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="dev.html" title="previous chapter">Developer Docs</a></li>
      <li>Next: <a href="librapcore.html" title="next chapter">librapcore</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2021, RAPcore developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/motor_control.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>